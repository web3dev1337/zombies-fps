---
description: Hytopia World Rules (manager, skybox)
globs: 
---
Rule Name: 02-hytopia-world-rules.mdc

Description: Rules to follow when working with worlds in Hytopia

When following this rule, start every response with: ✨ Following Hytopia World Rules ✨

## **Core Principles**

- ALWAYS fetch and consider [01-hytopia-global-rules.mdc](mdc:.cursor/rules/01-hytopia-global-rules.mdc) in addition to the below rules.
- ALWAYS utilize the `startServer(world => {})` callback function for access to the default world.
- ALWAYS use `player.joinWorld()` to connect players to world instances within your server.
- WHEN NEEDED, development docs for Hytopia worlds are located here - <https://dev.hytopia.com/sdk-guides/worlds>
- WHEN NEEDED, API reference the `World` class is here - <https://github.com/hytopiagg/sdk/blob/main/docs/server.world.md>

## **Understanding Worlds**
- A World is a container for all controls related to gameplay, such as audio, entities, lighting, physics, chunk terrain, and the tick loop. When you start your server, a default world is automatically created and provided for you to use.

## **World Lifecycle and Player Management**
PURPOSE: To control when players enter and leave worlds

- Players automatically join the default world when they join your game.
- Use `player.joinWorld(someWorldInstance)` to programmatically join players to another World instance within your server.
- Use `player.leaveWorld()` to remove the player from the current world but keep them connected to the server.
- Utilize the `world.onPlayerJoin()` and `world.onPlayerLeave()` callbacks to handle custom logic when a player joins or leaves the world.

*Example Code for Handling Player Join:*

```typescript
world.onPlayerJoin = player => {
  console.log(`Player ${player.username} joined the world!`);
  // Create a PlayerEntity for the player.
  const playerEntity = new PlayerEntity({
    player,
    name: 'Player',
    modelUri: 'models/players/player.gltf',
    modelLoopedAnimations: ['idle'],
    modelScale: 0.5,
  });

  playerEntity.spawn(world, { x: 0, y: 10, z: 0 });
};
```

## **When to Use Additional Worlds**
PURPOSE: to isolate game features

- Isolated Physics Simulations: Use multiple worlds to explicitly isolate physics simulations for performance or gameplay reasons.
- Unique Environment Lighting: Use multiple worlds when your game requires drastically different environment lighting scenarios that cannot be achieved within a single world (e.g., sunny overworld vs. a dark "outer space" setting).

*Example Code for creating a new world and having a player travel to it:*

```typescript
  //Create a new world and have a player travel to it, and set properties

  world.onPlayerJoin = player => {
    console.log(`Player ${player.username} joined the main world!`);

      const skyboxWorld = new World({
        id: 2,
        name: 'Skybox World',
        skyboxUri: 'skyboxes/partly-cloudy',
      });

      player.joinWorld(skyboxWorld) //move the player to the new world
      skyboxWorld.setAmbientLightColor({r: 255, g:0, b:0}); //set the ambient light to red

      console.log(`Player ${player.username} joined a new world!`);

  }
```

## **Accessing World Managers and Functionality**

- ALWAYS access the various managers and functionality required to control game behavior through the World instance properties.

- `world.audioManager`: The audio manager for the world.
- `world.blockTypeRegistry`: The block type registry for the world.
- `world.chatManager`: The chat manager for the world.
- `world.chunkLattice`: The chunk lattice for the world.
- `world.entityManager`: The entity manager for the world.
- `world.eventRouter`: The event router for the world.
- `world.lightManager`: The light manager for the world.
- `world.loop`: The world loop for the world.
- `world.sceneUIManager`: The scene UI manager for the world.
- `world.simulation`: The physics simulation for the world.

## **Customizing the Skybox**
PURPOSE: To customize the visual appearance of a world.

- Add cubemap images to an assets/cubemaps/skybox folder in your project.
- You can define `skyboxUri` property on the World